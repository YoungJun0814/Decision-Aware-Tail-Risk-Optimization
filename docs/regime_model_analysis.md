# π” Regime Classifier Ver2 λ¶„μ„ λ³΄κ³ μ„

> **λ¶„μ„ λ€μƒ**: [Regime_Classifier_Ver2.ipynb](file:///c:/Users/Jun/Desktop/Thesis/Projects/Decision-Aware-Tail-Risk-Optimization/notebooks/Regime_Classifier_Ver2.ipynb)
> **μ°Έμ΅°**: μ¤€μƒ 2μ›” 10μΌ λ―Έν… λ…ΈνΈ
> **μ‘μ„±μΌ**: 2026.02.13

---

## 1. π“ λ…ΈνΈλ¶ κµ¬μ΅° μ”μ•½

λ…ΈνΈλ¶μ€ **2κ°μ μ£Όμ” μ½”λ“ μ…€**λ΅ κµ¬μ„±λμ–΄ μμΌλ©°, κ°κ° λ…λ¦½μ μΈ `RobustRegimeClassifier` ν΄λμ¤λ¥Ό μ •μν•©λ‹λ‹¤.

| λ¨λΈ | Macro λ³€μ | States | λ μ§ λΌλ²¨ |
| :--- | :--- | :---: | :--- |
| **M1** (Term Spread) | T10Y3M | 3 | Bull, Uncertain, Crisis |
| **M2** (Credit Spread) | BAA10Y | 2 | Bull, Bear |

> [!IMPORTANT]
> λ‘ λ¨λΈ λ¨λ‘ κ³µν†µ Featureλ΅ **VIX Deviation**κ³Ό **Momentum Deviation**μ„ μ‚¬μ©ν•©λ‹λ‹¤. μ΄μ „ λ²„μ „μ—μ„ μ‚¬μ©ν•λ μλ»λ λ³€μλ“¤μ΄ μμ •λ κ²°κ³Όμ…λ‹λ‹¤.

---

## 2. π§¬ μ…λ ¥ λ³€μ λ³€κ²½ μ‚¬ν•­ (Key Change)

### λ³€κ²½ μ „ β†’ λ³€κ²½ ν›„

```diff
- VIX (μ›λ³Έ μμ¤€κ°’)
+ VIX Deviation = (VIX - VIX_3M_MA) / VIX_3M_MA

- Momentum (λ―Έν™•μΈ)
+ Momentum Deviation = (SPY_Close - SPY_12M_MA) / SPY_12M_MA

  Macro: T10Y3M (Term Spread) β€” M1
  Macro: BAA10Y (Credit Spread) β€” M2
```

### λ³€κ²½ μ΄μ  (μ¤€μƒ λ…ΈνΈ κΈ°λ°)

1. **VIX β†’ VIX Deviation**: μ›λ³Έ VIXλ” νΉμ • λ μ§μ— "κ³ μ°©(stick)"λλ” κ²½ν–¥μ΄ μμ. 3κ°μ›” μ΄λ™ν‰κ·  λ€λΉ„ νΈμ°¨λ΅ λ³€ν™ν•λ©΄ **κΈ‰κ²©ν• μ¤νμ΄ν¬(κ³µν¬ λ°μ‘)**λ¥Ό λ” μ ν¬μ°©ν•¨.
2. **Panic Ratio (VIX/VIX3M) λ―Έμ‚¬μ©**: VIX3M λ°μ΄ν„°κ°€ 2006λ…„λ¶€ν„°λ§ μ΅΄μ¬ν•μ—¬ λ°μ΄ν„° μ λ‹λ²„μ¤κ°€ λ„λ¬΄ μ ν•μ . VIX Deviationμ΄ λ€μ•μΌλ΅ μ±„νƒλ¨.
3. **κΈ°μ΅΄ λ³€μ μ¤λ¥ μμ •**: μ—¬λ¬ λ¨λΈμ—μ„ κ³µν†µμΌλ΅ μ‚¬μ©λλ μλ»λ λ³€μλ“¤μ΄ μμ •λ¨.

---

## 3. β™οΈ λ¨λΈ μ•„ν‚¤ν…μ² μƒμ„Έ

### κ³µν†µ κµ¬μ΅°: Expanding Window HMM

```mermaid
graph LR
    subgraph ExpandingWindow ["Expanding Window (min=60)"]
        direction TB
        A["t=60: Train on data[0:60]"] --> B["Predict regime at t=60"]
        B --> C["t=61: Train on data[0:61]"]
        C --> D["Predict regime at t=61"]
        D --> E["...repeat for all t..."]
    end
```

### ν•µμ‹¬ νλΌλ―Έν„°

| νλΌλ―Έν„° | κ°’ | μ„¤λ… |
| :--- | :--- | :--- |
| `n_components` | M1: **3** / M2: **2** | λ μ§ μ |
| `covariance_type` | `diag` | λ€κ° κ³µλ¶„μ‚° ν–‰λ ¬ |
| `n_iter` | 1000 | EM μ•κ³ λ¦¬μ¦ μµλ€ λ°λ³µ |
| `tol` | 1e-4 | μλ ΄ ν—μ© μ¤μ°¨ |
| `min_covar` | 1e-3 | μµμ† κ³µλ¶„μ‚° |
| `n_restarts` | 5 | λλ¤ μ΄κΈ°ν™” μ¬μ‹μ‘ νμ |
| `min_window` | 60 | μµμ† ν•™μµ μλ„μ° (60κ°μ›” = 5λ…„) |

### Dynamic State Re-ordering (μƒνƒ μ¬μ •λ ¬)

κ° μ‹μ λ§λ‹¤ HMMμ΄ μ¬ν•™μµλλ―€λ΅ state λ²νΈμ™€ μ‹¤μ  λ μ§μ λ§¤ν•‘μ΄ λ‹¬λΌμ§ μ μμµλ‹λ‹¤. μ΄λ¥Ό ν•΄κ²°ν•κΈ° μ„ν• ν•µμ‹¬ λ΅μ§:

```
Risk Score = mean(VIX_Dev) - mean(Momentum)
```

- **λ†’μ€ Risk Score** β†’ λ†’μ€ VIX νΈμ°¨ + λ‚®μ€ λ¨λ©ν…€ = **μ„κΈ° λ μ§**
- **λ‚®μ€ Risk Score** β†’ λ‚®μ€ VIX νΈμ°¨ + λ†’μ€ λ¨λ©ν…€ = **κ°•μ„Έ λ μ§**

μ΄ λ°©μ‹μΌλ΅ λ§¤ μ‹μ  μλ™μΌλ΅ statesλ¥Ό Bull β†’ Uncertain β†’ Crisis (λλ” Bull β†’ Bear) μμ„λ΅ μ •λ ¬ν•©λ‹λ‹¤.

---

## 4. π“ μ‹¤ν–‰ κ²°κ³Ό λ¶„μ„

### M1 (Term Spread + 3 States)
- **λ°μ΄ν„°**: 373 rows Γ— 4 features (VIX_Dev, Momentum, T10Y3M, SPY)
- **ν•™μµ**: 313 time steps (expanding window)
- **μλ ΄ κ²½κ³ **: λ‹¤μ λ°μƒ (`Model is not converging`) β€” EM μ•κ³ λ¦¬μ¦μ λ΅μ»¬ μµν‹°λ§ μ΄μλ΅, random restartλ΅ μ™„ν™”

### M2 (Credit Spread + 2 States)
- **λ°μ΄ν„°**: 373 rows Γ— 4 features (VIX_Dev, Momentum, BAA10Y, SPY)
- **ν•™μµ**: 313 time steps
- **μλ ΄ κ²½κ³ **: M1λ³΄λ‹¤ μ κ² λ°μƒ β€” 2-stateκ°€ 3-stateλ³΄λ‹¤ λ¨μ μ¶”μ •μ΄ μ•μ •μ 

---

## 5. π― λ¨λΈ μ„ νƒ: M2 (Credit Spread) κ¶μ¥

### μ¤€μƒ λ…ΈνΈ κΈ°λ° κ·Όκ±°

| ν‰κ°€ κΈ°μ¤€ | M1 (Term Spread) | M2 (Credit Spread) |
| :--- | :--- | :--- |
| **Kappa Score** | λ‚®μ | **λ†’μ** β… |
| **VIX Deviation μ‚¬μ© μ‹ μ„±λ¥** | **ν•λ½** β | μν–¥ μ μ |
| **μ§κ΄€μ  ν•΄μ„λ ¥** | λ³΄ν†µ | **μ°μ** |

> [!WARNING]
> **M1 μ„±λ¥ ν•λ½ μ›μΈ λ―Έν•΄κ²°**: VIX β†’ VIX Deviation λ³€κ²½ μ‹ M1μ μ„±λ¥μ΄ μ μλ―Έν•κ² ν•λ½ν• μ›μΈμ„ λ¶„μ„ν•΄μ•Ό ν•©λ‹λ‹¤. μ΄λ” Term Spreadκ°€ VIX Deviationκ³Όμ μ΅°ν•©μ—μ„ μ •λ³΄ μ¤‘λ³µ(multicollinearity)μ΄ λ°μƒν•  κ°€λ¥μ„±μ΄ μμµλ‹λ‹¤.

### Kappa Score ν•΄μ„ (Table 1 from Notes)

| Kappa λ²”μ„ | ν•΄μ„ |
| :--- | :--- |
| < 0 | μ°μ—°λ³΄λ‹¤ λ»ν• μΌμΉλ„ |
| 0.00 β€“ 0.20 | Slight |
| 0.21 β€“ 0.40 | Fair |
| 0.41 β€“ 0.60 | Moderate |
| 0.61 β€“ 0.80 | Substantial |
| 0.81 β€“ 1.00 | Almost Perfect |

---

## 6. π”¬ λ μ§ ν‰κ°€ λ°©λ²•λ΅ 

### ν„μ¬ λ°©μ‹μ ν•κ³„
- **M4 (λ‹¨μ λ¶„λ¥)** κΈ°λ° μ μ‚¬λ„ μΈ΅μ •: M4μ™€μ mismatchλ¥Ό κΈ°μ¤€μΌλ΅ M1/M2 ν‰κ°€
- M4λ” **ν΅λ³΄μ¥(sideways market)**μ„ λ¶„λ¥ν•μ§€ λ»ν•λ―€λ΅, M1/M2μ™€μ λΉ„κµμ— κ·Όλ³Έμ  ν•κ³„ μ΅΄μ¬

### ν‰κ°€ λ‹¤μ–‘ν™” (μ¤€μƒ μ μ•)
1. **Kappa Score**: λ μ§ λ¶„λ¥μ μΌμΉλ„λ¥Ό ν†µκ³„μ μΌλ΅ μΈ΅μ •
2. **Correlation**: λ μ§ ν™•λ¥ κ³Ό μ‹¤μ  μ‹μ¥ μ›€μ§μ„ κ°„μ μƒκ΄€κ΄€κ³„

> [!NOTE]
> κ·Όλ³Έμ  μ§λ¬Έ: "μµμ μ λ μ§ λ¶„λ¥ κΈ°μ¤€μ΄ λ¬΄μ—‡μΈκ°€?" β€” μ§κ΄€μ  μ΄ν•΄λ¥Ό λ„μ–΄μ„  λ³µμ΅ν• λ¨λΈμ΄ μ‹¤μ λ΅ ν•„μ”ν•μ§€μ— λ€ν• κ³ λ―Όμ΄ ν•„μ”ν•©λ‹λ‹¤.

---

## 7. π“‹ Next Steps (ν–¥ν›„ κ³Όμ )

| μμ„ | κ³Όμ  | μ°μ„ μμ„ |
| :---: | :--- | :---: |
| 1 | **M1 μ„±λ¥ ν•λ½ μ›μΈ λ¶„μ„**: VIX Deviation μ‚¬μ© μ‹ M1μ΄ μ™ μ„±λ¥μ΄ λ–¨μ–΄μ§€λ”μ§€ κ·λ… | π”΄ High |
| 2 | **λ³€μ μ¶”κ°€ νƒμƒ‰**: μ¶”κ°€ macro/market λ³€μλ΅ λ μ§ λ¶„λ¥ μ •ν™•λ„ ν–¥μƒ | π΅ Medium |
| 3 | **μµμ  λ μ§ λ¨λΈ κ°λ°**: M4 λ€μ²΄ κ°€λ¥ν• λ¨λΈ κµ¬μ¶• (ν΅λ³΄μ¥ ν¬μ°©) | π΅ Medium |
| 4 | **IOHMM λ„μ…**: Input-Output HMMμΌλ΅ μ™Έλ¶€ λ³€μλ¥Ό μ§μ ‘ μ „μ΄ ν–‰λ ¬μ— λ°μ | πΆ Low |
| 5 | **ν•μ΄νΌνλΌλ―Έν„° νλ‹**: Kappa, Eta λ“± Validation set κΈ°λ° μµμ ν™” | β³ λ¨λΈ ν™•μ • ν›„ |
| 6 | **2024 Out-of-Sample ν…μ¤νΈ**: λ―Έμ‚¬μ© λ°μ΄ν„°λ΅ μµμΆ… κ²€μ¦ | β³ λ§μ§€λ§‰ λ‹¨κ³„ |

---

## 8. π’΅ ν•µμ‹¬ κ΄€μ°° μ‚¬ν•­

### λ…ΈνΈλ¶ μ½”λ“ vs. μ¤€μƒ λ…ΈνΈ μƒμ΄μ 

> [!CAUTION]
> μ¤€μƒ λ…ΈνΈμ—μ„λ” M2λ¥Ό "**Credit Spread + 3 States**"λ΅ κΈ°μ ν–μΌλ‚, μ‹¤μ  λ…ΈνΈλ¶ μ½”λ“μ—μ„ M2λ” `n_states=2` (Bull, Bear)λ΅ κµ¬ν„λμ–΄ μμµλ‹λ‹¤. μ΄ μ°¨μ΄κ°€ μλ„μ μΈ κ²ƒμΈμ§€ ν™•μΈμ΄ ν•„μ”ν•©λ‹λ‹¤.
>
> - **λ…ΈνΈ**: M2 = Credit Spread + **3 States**
> - **μ½”λ“**: M2 = Credit Spread + **2 States**

### Feature Engineering νΉμ΄μ 
- VIX Deviationμ€ **λΉ„μ¨ κΈ°λ° νΈμ°¨**(%)λ΅ κ³„μ‚°λμ–΄, VIX μμ¤€κ°’ λ€λΉ„ μ¤μΌ€μΌμ— λ λ―Όκ°
- Momentumλ„ λ§μ°¬κ°€μ§€λ΅ **λΉ„μ¨ κΈ°λ° νΈμ°¨**λ΅ κ³„μ‚°
- μ΄ λ‘ feature λ¨λ‘ StandardScalerλ΅ μ •κ·ν™”λ ν›„ HMMμ— μ…λ ¥λ¨
- λ°μ΄ν„°λ” **μ›”κ°„ λ¦¬μƒν”λ§**λ μ‹κ³„μ—΄ μ‚¬μ©
